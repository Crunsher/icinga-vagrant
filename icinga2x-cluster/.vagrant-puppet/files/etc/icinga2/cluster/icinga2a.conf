/* icinga2a cluster config */

library "cluster"

const IcingaNodeName = "icinga2a"

object ClusterListener "icinga2-cluster" {
  ca_path = "/etc/icinga2/pki/ca.crt",
  cert_path = "/etc/icinga2/pki/icinga2a.crt",
  key_path = "/etc/icinga2/pki/icinga2a.key",

  bind_port = 8888,

  peers = [ "icinga2b" ]
}

object Endpoint "icinga2a" {
  host = "192.168.33.10",
  port = 8888,
}

object Endpoint "icinga2b" {
  host = "192.168.33.20",
  port = 8888,

  config_files = [ "/etc/icinga2/conf.d/*.conf" ],
}

object IcingaStatusWriter "cluster-status" {}


/* cluster health checks */
template Service "generic-cluster-service" {
  max_check_attempts = 3,
  check_interval = 60s,
  retry_interval = 30s,
  enable_perfdata = true
}

object HostGroup "cluster-node" { }

object Host "icinga2a" {
  display_name = "Health Checks on icinga2a",

  groups = [ "cluster-node" ],
  vars.address = "192.168.33.10",
  check_command = "dummy"
}

apply Service "cluster" {
  import "generic-cluster-service",
  check_command = "cluster",
  check_interval = 5s,
  retry_interval = 1s,
  authorities = [ "icinga2a" ],

  assign where host.name == "icinga2a"
}

apply Service "icinga" {
  import "generic-cluster-service",
  check_command = "icinga",
  authorities = [ "icinga2a" ],

  assign where host.name == "icinga2a"
}
