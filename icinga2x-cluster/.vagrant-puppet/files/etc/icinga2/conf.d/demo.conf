
/*
 * CheckCommands
 */

object CheckCommand "icinga-random-check" {
        methods = {
                execute = "RandomCheck"
        }
}

object CheckCommand "simple-uptime" inherits "plugin-check-command" {
  command = "echo `uptime` && exit 0"
}

object CheckCommand "mysql" inherits "plugin-check-command" {
  command = [
          "$plugindir$/check_mysql",
          "-H", "$address$",
          "-d", "$database$",
          "-u", "$username$",
          "-p", "$password$"
  ],

  macros = {
    database = "icinga",
    username = "icinga",
    password = "icinga"
  }
}

object CheckCommand "pgsql" inherits "plugin-check-command" {
  command = [
          "$plugindir$/check_pgsql",
          "-H", "$address$",
          "-d", "$database$",
          "-l", "$username$",
          "-p", "$password$"
  ],

  macros = {
    database = "icinga",
    username = "icinga",
    password = "icinga"
  }
}

object CheckCommand "dns" inherits "plugin-check-command" {
  command = [
          "$plugindir$/check_dns",
          "-H", "$domain$",
          "-s", "$address$" 
  ]
}

object CheckCommand "mail" inherits "plugin-check-command" {
  command = [
          "$plugindir$/check_mailq",
          "-w", "$warn$",
          "-c", "$crit$"
  ],
  macros = {
    warn = 5,
    crit = 25
  }
}

object CheckCommand "ldap" inherits "plugin-check-command" {
  command = [
          "$plugindir$/check_ldap",
          "-H", "$address$",
          "-b", "$basedn$"
  ],
  macros = {
    basedn = "dc=icinga,dc=org"
  }
}

object CheckCommand "snmp-interface" inherits "plugin-check-command" {
  command = [
          "$plugindir$/check_snmp_int.pl",
          "-H", "$address$",
          "-C", "$community$",
          "-$version$",
          "-n", "$interface$",
          "-k", "-f",
          "-w", "$inputwarn$,$outputwarn$",
          "-c", "$inputcrit$,$outputcrit$",
  ],
  macros = {
    community = "public",
    version = 2,
    interface = "eth0",
    inputwarn = 200,
    outputwarn = 400,
    inputcrit = 0,
    outputcrit = 600
  }
}


/*
 * Service Groups
 */

object ServiceGroup "cluster" {
  display_name = "Cluster Checks"
}

object ServiceGroup "dns" {
  display_name = "DNS Checks"
}

object ServiceGroup "db" {
  display_name = "DB Checks"
}

object ServiceGroup "http" {
  display_name = "HTTP Checks"
}

object ServiceGroup "network" {
  display_name = "Network Checks"
}

object ServiceGroup "mail" {
  display_name = "Mail Checks"
}

object ServiceGroup "ping" {
  display_name = "Network Checks"
}

object ServiceGroup "ldap" {
  display_name = "LDAP Checks"
}

/*
 * Host Groups
 */

object HostGroup "network-device" {
  display_name = "Network Devices"
}

object HostGroup "database-server" {
  display_name = "Database Servers"
}

object HostGroup "mail-server" {
  display_name = "Mail Servers"
}

object HostGroup "web-server" {
  display_name = "Web Servers"
}

object HostGroup "ad-server" {
  display_name = "LDAP AD Server"
}

object HostGroup "dns-server" {
  display_name = "DNS Server"
}

object HostGroup "cluster-server" {
  display_name = "Cluster Server"
}

/*
 * Users
 */

object User "dnsmichi" {
  macros = {
    email = "michael.friedrich@gmail.com"
  },
  groups = [ "manager" ]
}

object UserGroup "manager" {
  display_name = "Icinga Manager"
}

/*
 * Templates
 */

template Service "random-check" inherits "generic-service" {
  check_command = "icinga-random-check",
  groups = [ "cluster" ]
}

template Service "generic-demo-service" inherits "generic-service" {
    check_command = "ping4"
}

template Host "generic-demo-host" inherits "generic-host" {
  display_name = "demo-host",

  services["ping4"] = {
    templates = [ "generic-demo-service" ],
    groups = [ "ping" ],
  },

  macros = {
    address = "127.0.0.1",
    address6 = "::1"
  },

  groups = [ "linux-server" ],

  check = "ping4"
}

template Host "mail-demo-host" inherits "generic-demo-host" {
  services["mail"] = {
    templates = [ "generic-demo-service" ],
    check_command = "mail",
    groups = [ "mail" ],
  },

  groups = [ "mail-server" ],

}

template Host "mysql-demo-host" inherits "generic-demo-host" {
  services["mysql"] = {
    templates = [ "generic-demo-service" ],
    check_command = "mysql",
    groups = [ "db" ]
  },

  groups = [ "database-server" ],

  check = "mysql"
}

template Host "pgsql-demo-host" inherits "generic-demo-host" {
  services["postgresql"] = {
    templates = [ "generic-demo-service" ],
    check_command = "pgsql",
    groups = [ "db" ]
  },

  groups = [ "database-server" ],

  check = "pgsql"
}

template Host "dns-demo-host" inherits "generic-demo-host" {
  services["dns netways.de"] = {
    templates = [ "generic-demo-service" ],
    check_command = "dns",
    macros += {
      domain = "netways.de"
    },
    groups = [ "dns" ],
  },
  services["dns icinga.org"] = {
    templates = [ "generic-demo-service" ],
    check_command = "dns",
    macros += {
      domain = "icinga.org"
    },
    groups = [ "dns" ],

    notifications["mail"] = {
      templates = [ "mail-notification" ],
      user_groups = [ "manager" ]
    }
  },

  services["dns monitoringexchange.org"] = {
    templates = [ "generic-demo-service" ],
    check_command = "dns",
    macros += {
      domain = "monitoringexchange.org"
    },
    groups = [ "dns" ]
  },

  macros = {
    address = "ns1.netways.de"
  },

  groups = [ "dns-server" ],

  check = "dns netways.de"
}

template Host "http-icinga-host" inherits "generic-demo-host" {
  services["http www.icinga.org"] = {
    templates = [ "generic-demo-service" ],
    check_command = "http_vhost",
    macros += {
      vhost = "www.icinga.org"
    },
    groups = [ "http" ]
  },
  services["http wiki.icinga.org"] = {
    templates = [ "generic-demo-service" ],
    check_command = "http_vhost",
    macros += {
      vhost = "wiki.icinga.org"
    },
    groups = [ "http" ]
  },
  services["http docs.icinga.org"] = {
    templates = [ "generic-demo-service" ],
    check_command = "http_vhost",
    macros += {
      vhost = "docs.icinga.org"
    },
    groups = [ "http" ]
  },
  services["http dev.icinga.org"] = {
    templates = [ "generic-demo-service" ],
    check_command = "http_vhost",
    macros += {
      vhost = "dev.icinga.org"
    },
    groups = [ "http" ]
  },

  macros = {
    address = "web.icinga.org"
  },

  groups = [ "web-server" ],

  check = "ping4"
}

template Host "ldap-icinga-demo-host" inherits "generic-demo-host" {
  services["icingaweb-ad"] = {
    display_name = "Icinga Web AD",
    templates = [ "generic-demo-service" ],
    check_command = "ldap",
    groups = [ "ldap" ]
  },

  groups = [ "ad-server" ],

  check = "ldap"
}

template Host "router-demo-host" inherits "generic-demo-host" {
  services["uptime"] = {
    display_name = "Uptime",
    templates = [ "generic-demo-service" ],
    check_command = "simple-uptime",
    groups = [ "network" ]
  },

  groups = [ "network-device" ],

  check = "uptime"
}


/*
 * Sample DNS Hosts
 */

object Host "dns-master" inherits "dns-demo-host" {
  display_name = "DNS Master"
}

/*
 * Sample Mail Hosts
 */

object Host "mail-c1" inherits "mail-demo-host" {
  display_name = "Mail C1"
}

/*
 * Sample DB Hosts
 */

object Host "mysql-c1" inherits "mysql-demo-host" {
  display_name = "MySQL C10"
}

object Host "mysql-c12-extern" inherits "mysql-demo-host" {
  display_name = "MySQL C12 Extern",
  macros = {
    address = "192.168.255.255"
  }
}

object Host "postgresql-c20" inherits "pgsql-demo-host" {
  display_name = "PostgreSQL C20"
}

object Host "postgresql-c30-extern" inherits "pgsql-demo-host" {
  display_name = "PostgreSQL C30 Extern",
  services["postgresql"] = {
    templates = [ "generic-demo-service" ],
    check_command = "pgsql",
    macros = {
      database = "template1",
      username = "remote-role",
      password = "remote-pass"
    },
    groups = [ "db" ]
  },

}

/*
 * Sample Webserver Hosts
 */

object Host "web.icinga.org" inherits "http-icinga-host" {
  display_name = "Icinga Webserver",
}

/*
 * Sample LDAP Hosts
 */

object Host "ldap-server" inherits "ldap-icinga-demo-host" {
  display_name = "LDAP AD Server",
}


/*
 * Sample Network Hosts
 */

object Host "core-router" inherits "router-demo-host" {
  display_name = "Core Router",
}

object Host "backup-router" inherits "router-demo-host" {
  display_name = "Backup Router",
}

object Host "hp-procurve-switch" inherits "router-demo-host" {
  display_name = "HP Procurve Switch",
  services["if-errors"] = {
    display_name = "Interface Errors",
    templates = [ "generic-demo-service" ],
    check_command = "snmp-interface",
    groups = [ "network" ]
  },
  services["if-traffic-eth0"] = {
    display_name = "Interface Traffic eth0",
    templates = [ "generic-demo-service" ],
    check_command = "snmp-interface",
    macros += {
      interface = "eth0"
    },
    authorities = [ "icinga2a" ],
    groups = [ "network" ]
  },
  services["if-traffic-eth1"] = {
    display_name = "Interface Traffic eth1",
    templates = [ "generic-demo-service" ],
    check_command = "snmp-interface",
    macros += {
      interface = "eth1"
    },
    authorities = [ "icinga2a" ],
    groups = [ "network" ]
  },
}

/*
 * Random Host
 */

template Host "cluster-demo-host" inherits "generic-host" {
  display_name = "Icinga 2 Clustered Checks",
  services["random001"] = { templates = [ "random-check" ] },
  services["random002"] = { templates = [ "random-check" ] },
  services["random003"] = { templates = [ "random-check" ] },
  services["random004"] = { templates = [ "random-check" ] },
  services["random005"] = { templates = [ "random-check" ] },

  custom = {
    notes = "Distributed Checks on Cluster Nodes. Verify Check Output / Source!"
  }
}

object Host "icinga2-clustered-checks" inherits "cluster-demo-host" {}

